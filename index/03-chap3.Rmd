# Mise en place d’une stratégie pour l’analyse des données exomiques – application en recherche clinique  

```{r include.packages2, include = FALSE}
# This chunk ensures that the thesisdown package is
# installed and loaded. This thesisdown package includes
# the template files for the thesis.

if(!require(devtools))
  install.packages("devtools", repos = "http://cran.rstudio.com")
if(!require(thesisdown))
  devtools::install_github("ismayc/thesisdown")

library(thesisdown)
library(knitr)
library(tidyr)
library(dplyr)
library(data.table)
library(ggplot2)
library(stringi)

opts_knit$set(eval.after = c("fig.cap","fig.scap"))

knitr::opts_chunk$set(fig.align='center',echo=FALSE)

knitr::opts_knit$set(kable.force.latex = TRUE)

```
## Intro  

<!-- Comme vu précédemment, l'émergence du séquençage haut débit avec notamment les séquençages de génomes ou d'exomes entiers a révolutionné les méthodes de recherche dans le cadre d'étude phénotype-génotype...   -->




<!-- Etats des lieux : les logiciels existants, les pipelines leurs limites. -->

<!-- Ce chapitre décrit la constitution et l’utilisation d’un pipeline d’analyse des données de séquençage exomique et son utilisation dans le cadre de la recherche de mutations entrainant différents phénotypes d’infertilité. La difficulté des études génétiques visant à identifier des gènes pathogènes vient de l’abondance de variants rares chez tout un chacun et de la difficulté d’effectuer des tris efficaces et justes pour ne retenir que la ou les mutations causales. Thomas développe un pipeline se basant sur des outils existant mais permettant d’effectuer des tris successifs efficaces et pertinents   -->


Dans ce chapitre, je détaillerai les résultats de 4 articles dont je suis coauteur : 

1. [**Whole-exome sequencing of familial cases of multiple morphological abnormalities of the sperm flagella (MMAF) reveals new DNAH1 mutations**](#famdnah1) : [todo]
2. [**Homozygous mutation of PLCZ1 leads to defective human oocyte activation and infertility that is not rescued by the WW-binding protein PAWP**](#plcz) : Dans cet article j'ai, comme précédemment, effectué l'integralité des analyses bioinformatiques des données d'exomes effectués sur deux frères infertiles présentant des échecs de fécondation.  
3. [**SPINK2 deficiency causes infertility by inducing sperm defects in heterozygotes and azoospermia in homozygotes**](#spink2) : Dans cet article j'ai effectuer non seulement l'intégralité des analyses bioinformatiques des données d'exomes de deux frères infertiles présentant un phénotype d'azoospermie mais aussi séquencer en Sanger les séquences codantes du gène *SPINK2* pour une parie des 611 individus analyser ainsi que contribué à l'extraction de l'ARN testiculaire des souris pour l'analyse fonctionelle du gène *Spink2* sur le modèle murin.  
4. [****](#cohortemmah) : [todo]

## Résultats  

```{r all_coding_variants, cache=TRUE}

df_all_coding_variants <- fread("data/all_coding_variants_vep81.csv", sep = "\t", header = TRUE, showProgress = FALSE, verbose = FALSE)

```

### Description de la pipeline  

Notre pipeline d'analyse effectue l'ensemble des étapes allanbt de l'alignement des données jusqu'au filtrage des variants  

L'alignement est effectué grâce à l'aligneur MAGIC [@Su2014] qui produit des comptages *quality-adjusted* "variants" et "référence" pour chaque *strands* des *reads* *paired-end* de manière indépendente et ceux, pour chaque position génomique couverte. Les *reads* duppliqués et les *reads* s'alignant sur plusieurs régions génomiques sont exclus des analyses. 

Positions whose sequence coverage was below 10 on either the forward or reverse strand were marked as low confidence, and positions whose coverage was below 10 on both strands were excluded. 


Les SNVs et indels sont ensuite identifié grâce à un algorithme d'appel "maison" [TODO: décrire l'algo].
L'impact des variants identifiés est ensuite prédit grâce au logiciel variant effect predictor [@McLaren2016] de même que pour chaque variant nous ajoutons sa fréquence dans les bases de données ExAC, ESP6500 et 1000Genomes si celui-ci y est recanssé.
Le 


(SNV) and small insertions/deletions (indels) were identified and quality-filtered using in-

house scripts. Briefly, for each variant, independent calls are made on each strand, and only

positions where both calls agree are retained. The most promising candidate variants were

identified using an in-house bioinformatics pipeline, as follows. Variants with a minor allele

frequency greater than 5% in the NHLBI ESP6500



<!-- description des outils choisis et de la pipeline   -->

### utilisations de la pipeline pour l’identifications de variants pathogènes et l’identification de nouveaux gènes impliqués dans l’infertilité  
\newpage  

#### Etude familiale MMAF -> DNAH1  {#famdnah1}  
\newpage  

#### Etude familiale echec de fécondation -> PLCzeta  {#plcz}  

```{r plczdata, message=FALSE, cache=TRUE}

####
# Loading data
####

df_variants_b1_b2 <- fread("data/genotype_plcz.csv", sep = "\t", header = TRUE, showProgress = FALSE, verbose = FALSE) %>%
  gather(RUN, CALL, starts_with("Ghs")) %>%
  filter(CALL %in% c(2, 3, "b", "c")) %>%
  mutate(TYPE = if_else(stri_length(REF) == stri_length(ALT), "SNV", "Indel"), 
         STRAND = if_else(CALL %in% c(2, 3), "Both_strand", "Single_strand"),
         GENOTYPE = if_else(CALL %in% c(2, "b"), "Heterozygous", "Homozygous"),
         RUN = if_else(RUN == "Ghs113", "B1", "B2")) 

df_ctrl <- fread("data/genotype_not_fert_fail.csv", sep = "\t", header = TRUE, showProgress = FALSE, verbose = FALSE) %>% 
  gather(RUN, CALL, starts_with("Ghs")) %>%
  filter(CALL %in% c(3, "c")) %>%
  select(-CALL)

####
# Filtering
####

# Variants carried by B1
df_variants_b1 <- filter(df_variants_b1_b2, RUN == "B1")
# Variants carried by B2
df_variants_b2 <- filter(df_variants_b1_b2, RUN == "B2")

# Only homozygous variants 
# Shared by B1 AND B2
df_filter_common_variants <- inner_join(df_variants_b1, df_variants_b2, 
                                        by = c("CHR", "POSITION", "REF", "ALT", "GENOTYPE", "TYPE")) %>%
  select(-ends_with(".x"), -ends_with(".y")) %>%
  inner_join(df_all_coding_variants, 
             by = c("CHR", "POSITION", "REF", "ALT"))

df_filter_common_homo_variants <- filter(df_filter_common_variants, GENOTYPE == "Homozygous")

df_filter_impact <-   filter(df_filter_common_homo_variants,
                             Consequence != "synonymous_variant",     # Filter variant considering their impact on transcript
                             Consequence != "5_prime_UTR_variant",
                             Consequence != "3_prime_UTR_variant",
                             Consequence != "intergenic_variant",
                             !grepl("NMD_transcript_variant",Consequence),
                             !(grepl("tolerated", SIFT) & grepl("benign", PolyPhen)))

maf_cutoff <- 0.01
df_filter_freq <- filter(df_filter_impact,
                         is.na(ExAC_AF) | ExAC_AF <= maf_cutoff,
                         is.na(ESP) | ESP <= maf_cutoff,
                         is.na(`1KG`) | `1KG` <= maf_cutoff) %>%
  anti_join(df_ctrl, by = c("CHR", "POSITION", "REF", "ALT")) %>%   # Filter variants observed as homo in other patho1
  select(-Feature_type, -BIOTYPE, -SYMBOL_SOURCE, -HGNC_ID, CADD_RAW, ExAC_AF_FIN, ExAC_AF_OTH, -(ExAC_AF_AMR:ExAC_AF_SAS))

df_passing_filter_genes <- distinct(df_filter_freq, SYMBOL, CHR, POSITION, REF, ALT) %>%
       select(Chromosome = CHR, Position = POSITION, `Reference allele` = REF, `Alterated allele` = ALT, Gene = SYMBOL)

```

```{r plczetatabcommonvar}

tab.name <- "Comptage des variants communs à B1 et B2"

knitr::kable(group_by(df_filter_common_variants, TYPE, GENOTYPE) %>%
               select(Genotype = GENOTYPE, `Variant type` = TYPE) %>%
               summarise(Count = n()) %>%
               arrange(desc(`Variant type`)),
             caption = tab.name)

```

```{r varplcz, fig.cap=fig.info,fig.scap=fig.name,fig.width=4.5,fig.height=3.8}

fig.name <- "Comptage des variants retrouvés sur les frères B1 et B2 avec leur génotypes associés"
fig.description <- ""
fig.info <- paste(fig.name)

ggplot(df_variants_b1_b2, aes(GENOTYPE)) +
  geom_bar(aes(fill = RUN), position = position_dodge()) +
  scale_fill_discrete(name = "Patient") +
  xlab("Variants genotypes") +
  ylab("Count")

```

\newpage  

#### Etude familiale azoospermie : SPINK2  {#spink2}

##### Description de la cohorte familiale  

Comme nous avons pu le voir, l'[azoospermie](#infquant) est un phénotype d'infertilité masculine caractérisé par l'absence de spermatozoïde dans l'éjaculat. En 2017, notre équipe a publiée des résultats liant une mutation du gène *SPINK2* à ce phénotype. Pour cette étude, nous avons effectué un séquençage exomique de deux frères azoospermes (B1 et B2) issus d'un union consanguin puisque leurs parents sont cousin au deuxième degré (**Figure : **\@ref(fig:spink2tree)). Étant donné l'historique consanguin de cette famille nous avons emis l'hypothèse d'un phénotype à transmission autosomique recessif. 

```{r spink2tree,fig.cap=fig.info,fig.scap=fig.name, out.extra="scale=0.75"}

fig.name <- "Arbre généalogique des deux frères azoospermes B1 et B2"
fig.description <- "Sur cette arbre nous pouvons observés la parentés des parents (P1 et P2), cousins au deuxième degré"
fig.info <- paste(fig.name,fig.description, sep = " : ")

include_graphics(path = "figure/spink2_arbre_genealogique.png")

```

```{r spink2data, message=FALSE, cache=TRUE}

####
# Loading data
####

df_variants_b1_b2 <- fread("data/genotype_spink2_brothers.csv", sep = "\t", header = TRUE, showProgress = FALSE, verbose = FALSE) %>%
  gather(RUN, CALL, starts_with("Ghs")) %>%
  filter(CALL %in% c(2, 3, "b", "c")) %>%
  mutate(TYPE = if_else(stri_length(REF) == stri_length(ALT), "SNV", "Indel"), 
         STRAND = if_else(CALL %in% c(2, 3), "Both_strand", "Single_strand"),
         GENOTYPE = if_else(CALL %in% c(2, "b"), "Heterozygous", "Homozygous"),
         RUN = if_else(RUN == "Ghs44", "B1", "B2")) 

df_ctrl <- fread("data/genotype_not_azoo.csv", sep = "\t", header = TRUE, showProgress = FALSE, verbose = FALSE) %>%
  gather(RUN, CALL, starts_with("Ghs")) %>%
  filter(CALL %in% c(3, "c")) %>%
  select(-CALL)

####
# Filtering
####


# Variants carried by B1
df_variants_b1 <- filter(df_variants_b1_b2, RUN == "B1")
# Variants carried by B2
df_variants_b2 <- filter(df_variants_b1_b2, RUN == "B2")

# Only homozygous variants 
# Shared by B1 AND B2
df_filter_common_variants <- df_variants_b1 %>%
  inner_join(df_variants_b2, by=c("CHR","POSITION","REF","ALT","GENOTYPE","TYPE")) %>%
  select(-ends_with(".x"), -ends_with(".y")) %>%
  inner_join(df_all_coding_variants,by = c("CHR", "POSITION", "REF", "ALT"))

df_filter_common_homo_variants <- filter(df_filter_common_variants,GENOTYPE == "Homozygous")

df_filter_impact <-   filter(df_filter_common_homo_variants,
                             Consequence != "synonymous_variant",     # Filter variant considering their impact on transcript
                             Consequence != "5_prime_UTR_variant",
                             Consequence != "3_prime_UTR_variant",
                             Consequence != "intergenic_variant",
                             !grepl("NMD_transcript_variant",Consequence),
                             !(grepl("tolerated",SIFT) & grepl("benign",PolyPhen)))

maf_cutoff <- 0.01
df_filter_freq <- filter(df_filter_impact,
                         is.na(ExAC_AF) | ExAC_AF <= maf_cutoff,
                         is.na(ESP) | ESP <= maf_cutoff,
                         is.na(`1KG`) | `1KG` <= maf_cutoff) %>%
  # Filter variants observed as homo in other patho
  anti_join(df_ctrl, by = c("CHR", "POSITION", "REF", "ALT")) %>%
  select(-Feature_type,-BIOTYPE,-SYMBOL_SOURCE,-HGNC_ID,CADD_RAW,ExAC_AF_FIN,ExAC_AF_OTH,-(ExAC_AF_AMR:ExAC_AF_SAS))


df_passing_filter_genes <- distinct(df_filter_freq,
                                    SYMBOL,CHR,POSITION,REF,ALT) %>%
       select(Chromosome = CHR, Position = POSITION,`Reference allele` = REF,`Alterated allele` = ALT,Gene=SYMBOL)

```

##### Séquençage WES et analyse bioinformatique  

Le séquençage exomique des deux frères B1 et B2 fût réalisé au Mount Sinaï Institutes en [TODO: mettre l'année du séquençage]. Suite à celà nous avons, comme pour les études précédentes nous avons appliqué notre pipeline d'analyse nous permettant de recansser un total de `r nrow(df_variants_b1)` variants différents pour B1 et `r nrow(df_variants_b2)` pour B2 (**Figure : **\@ref(fig:varb1b2)). Ayant emmit l'hypothèse d'une cause génétique commune expliquant le phénotype des deux frères, nous nous sommes concentrés uniquement sur les variants homozygotes communs aux deux frères réduisant ainsi notre liste de variant à un total de `r nrow(df_filter_common_homo_variants)` variants dont `r nrow(df_filter_common_homo_variants %>% filter(TYPE == "SNV"))` SNVs et `r nrow(df_filter_common_homo_variants %>% filter(TYPE == "Indel"))` indels (**Table : **\@ref(tab:tabcommonvar)). À partir de cette liste, nous avons soustrait l'ensemble des variants prédit par VEP comme n'impactant pas un transcrit codant pour une protéine. De même, nous avons filtrer l'ensemble des variant présent dans les séquences UTRs ou encore ceux causant une substitution synonymes ou une substitution faux-sens prédite "benign" par PolyPhen2 et "tolerated" par SIFT. Suite à cela, nous avons filtrer les variants fréquents dans la population générale en filtrant l'ensemble des variant ayant une MAF $\ge$ `r maf_cutoff`, de même, nous avons confrontés les variants restant à une base de donnée interne ressencant les variant de `r nrow(select(df_ctrl,RUN) %>% distinct(RUN))` individus non atteint d'azoospermie afin de filtrer les variants homozygotes retrouvés dans cette basse de données de contrôle.  

```{r tabcommonvar}

tab.name <- "Comptage des variants communs à B1 et B2"

knitr::kable(group_by(df_filter_common_variants, TYPE, GENOTYPE) %>% 
        select(Genotype = GENOTYPE,`Variant type` = TYPE) %>% 
        summarise(Count = n()) %>% 
        arrange(desc(`Variant type`)),
      caption = tab.name)

```

```{r varb1b2, fig.cap=fig.info,fig.scap=fig.name,fig.width=4.5,fig.height=3.8}

fig.name <- "Comptage des variants retrouvés sur les frères B1 et B2 avec leur génotypes associés"
fig.description <- ""
fig.info <- paste(fig.name)

ggplot(df_variants_b1_b2,aes(GENOTYPE)) +
  geom_bar(aes(fill = RUN),position = position_dodge()) +
  scale_fill_discrete(name = "Patient") +
  xlab("Variants genotypes") +
  ylab("Count")

```

Après avoir appliqué l'ensemble de ces filtres, nous sommes arrivés à une liste de `r nrow(distinct(df_filter_freq, CHR, POSITION, REF, ALT))` variants impactant `r nrow(df_passing_filter_genes)` gènes différents : *SPINK2* et *GUF1* (**Table : **\@ref(tab:passingfiltervar)). Parmi ces deux gènes, seul *SPINK2* était décrit comme fortement exprimé dans le testicule [INS2RER FIGURE ACEVIEW]. Nous avons d'ailleurs pu confirmer cette forte expression par RT-PCR quantitative en temps réel  forte à la fois chez l'Homme (**Figure : **\@ref(fig:spink2exp) - **A**) et chez la souris (**Figure : **\@ref(fig:spink2exp) - **B**). Ces données ont donc fait de *SPINK2* le seul candidat évident pouvant expliquer ce phénotype. Le variant partagé par les deux frères : Chr4:57686748G>C n'a été recencé dans aucune des bases de données que sont ExAC, 1000Genomes et ESP6500. Le gène *SPINK2* est localisé sur le chromosome 4 et contient 4 exons (**Figure : **\@ref(fig:spink2exp)). Sa localisation intronique à 3 pb du 2$^{ième}$ exon indique que ce variant pourrait avoir un effet sur l'épissage de l'ARNm

```{r passingfiltervar}

tab.name <- "Liste des variants ayant passé l'ensemble des filtres"
kable(df_passing_filter_genes,caption = tab.name)

```

```{r spink2exp, fig.cap=fig.info,fig.scap=fig.name, out.extra="scale=0.42"}

fig.name <- "Expression du gène *SPINK2* dans plusieurs tissus"
fig.description <- "On peut constater que chez l'humain (**A**) comme chez la souris (**B**), le gène *SPINK2* a non seulement une forte expression exclusive au testicule"
fig.info <- paste(fig.name,fig.description, sep = " : ")

include_graphics(path = "figure/spink2_expression.png")

```

```{r spink2trans, fig.cap=fig.info,fig.scap=fig.name, out.extra="scale=0.42"}

fig.name <- "Représentation du gène *SPINK2*"
fig.description <- "L'épissage du gène *SPINK2* crée un transcrit de 4 exons (Transcrit normal). Cependant, le variant c.206-3C>G observé chez les frères B1 et B2 crée un nouveau site accepteur d'épissage ajoutant 2 nucléotides à l'exon 2 induisant un décalage du cadre de lecture menant à un codon stop 3 nucléotides plus loin (Transcrit 1) et / ou causant le saut de l'exon 2 menant à un codon stop prématuré (Transcrit 2)"
fig.info <- paste(fig.name,fig.description, sep = " : ")

include_graphics(path = "figure/spink2_transcripts.png")

```

##### Estimation de l'incidence du gène *SPINK2* chez des patients azoospermes  

Afin de déterminer l'incidence des variants du gène *SPINK2* dans la population azoospermiques nous avons séquencé l'intégralité des séquences codantes de ce gène chez 611 individus comprenant 210 patients azoospermiques, 393 oligozoospermiques et présentant un phénotype non spécifié. Parmi cet ensemble de patient, seul le patient 105 (P105) présentant un phénotype d'oligozoospermie s'est révélé porteur d'un variant non répertorié dans les bases de données et présentant un impact prédit comme délétère. Ce variant, c.1A>T, présent à l'état hétérozygote chez P105 affecte le codon start décalant ainsi le démarage de la traduction produisant ainsi une protéine tranquée.   

##### Autres résultats  

Dans cette même étude nous avons égallement pu étudié les caractéristiques reproductives de souris KO *Spink2*$^{-/-}$ et de souris hétérozygotes *Spink2*$^{+/-}$ . Ainsi, nous avons pu confirmer que les souris mâles KO étaient infertiles et présentaient un phénotype d'azoospermie ainsi qu'une diminution de la taille de leurs testicules tandis que les hétérozygotes étaient parfaitement fertiles bien leur nombre de spermatozoïdes par mL de sperme soit plus faibles que les souris sauvages. Les souris femelles, elles, présentaient des caractéristiques reproductives tout à fait normal. [TODO: finir cette partie].      

```{r spink2cleanup, include=FALSE}

rm(list=ls(all=TRUE))
gc()
```

\newpage  

#### Etude d’une large cohorte de patients MMAF  {#cohortemmah}  

<!-- 1. Les nouveaux gènes candidats évidents   -->
<!-- 2. L’efficacité diagnostique    -->
<!-- 3. L’analyse individuelle   -->
<!--     a. Les mutations dans les gènes identifiés   -->
<!--     b. Liste complète des gènes avec 2 variants tronquants   -->
<!--     c Liste complète des gènes avec deux variants dont un tronquant   -->
<!--     d. Liste des  gènes avec 2 variants intronique ou faux-sens/synonymes avec un score élevé UMD-predictor ou HSF.   -->
<!--     e. Liste des gènes avec un variant hétérozygote tronquant   -->